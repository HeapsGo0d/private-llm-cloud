<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Private LLM - Privacy Dashboard</title>
    <style>
        :root {
            --primary-color: #059669;
            --secondary-color: #1f2937;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
            --background-color: #f0fdf4;
            --card-background: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #d1fae5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card-background);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 2px solid var(--border-color);
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary-color), #064e3b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 24px;
        }

        .privacy-status {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--success-color);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: var(--card-background);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .metric-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .metric-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .metric-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .metric-icon.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
        }

        .metric-icon.info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
        }

        .metric-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .metric-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .metric-description {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .security-checklist {
            background: var(--card-background);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .check-icon.passed {
            background: var(--success-color);
            color: white;
        }

        .check-icon.failed {
            background: var(--error-color);
            color: white;
        }

        .check-icon.warning {
            background: var(--warning-color);
            color: white;
        }

        .network-monitor {
            background: var(--card-background);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .connections-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .connection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .connection-item.external {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .privacy-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .control-button {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .control-button.primary {
            background: var(--primary-color);
            color: white;
        }

        .control-button.secondary {
            background: var(--secondary-color);
            color: white;
        }

        .control-button.warning {
            background: var(--warning-color);
            color: white;
        }

        .control-button.danger {
            background: var(--error-color);
            color: white;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .logs-viewer {
            background: var(--card-background);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .logs-content {
            background: #1f2937;
            color: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .real-time-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 1px solid;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 16px;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring .background {
            stroke: #e5e7eb;
        }

        .progress-ring .progress {
            stroke: var(--success-color);
            stroke-dasharray: 0 100;
            transition: stroke-dasharray 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="real-time-indicator">
        <div class="pulse"></div>
        Real-time Monitoring Active
    </div>

    <div class="container">
        <div class="header">
            <h1>🛡️ Privacy Dashboard</h1>
            <p>Real-time monitoring of your private LLM infrastructure</p>
            <div class="privacy-status">
                🔒 Maximum Privacy Mode Active
            </div>
        </div>

        <!-- Key Metrics Grid -->
        <div class="dashboard-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon success">🔐</div>
                    <div class="metric-title">Privacy Score</div>
                </div>
                <div class="metric-value" id="privacy-score">100%</div>
                <div class="metric-description">Overall privacy compliance rating</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon info">📡</div>
                    <div class="metric-title">Network Status</div>
                </div>
                <div class="metric-value" id="network-status">Isolated</div>
                <div class="metric-description">External connection monitoring</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon success">🗂️</div>
                    <div class="metric-title">Data Encryption</div>
                </div>
                <div class="metric-value" id="encryption-status">Active</div>
                <div class="metric-description">All data encrypted at rest</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon warning">⏱️</div>
                    <div class="metric-title">Session Time</div>
                </div>
                <div class="metric-value" id="session-time">0:00:00</div>
                <div class="metric-description">Current session duration</div>
            </div>
        </div>

        <!-- Security Checklist -->
        <div class="security-checklist">
            <h2 class="section-title">🔍 Security Checklist</h2>
            <div id="security-checks">
                <div class="checklist-item">
                    <div class="check-icon passed">✓</div>
                    <div>
                        <strong>Telemetry Disabled</strong>
                        <div class="metric-description">All external tracking and analytics disabled</div>
                    </div>
                </div>
                <div class="checklist-item">
                    <div class="check-icon passed">✓</div>
                    <div>
                        <strong>Data Encryption</strong>
                        <div class="metric-description">All sensitive data encrypted with AES-256</div>
                    </div>
                </div>
                <div class="checklist-item">
                    <div class="check-icon passed">✓</div>
                    <div>
                        <strong>Secure Authentication</strong>
                        <div class="metric-description">API keys and sessions properly secured</div>
                    </div>
                </div>
                <div class="checklist-item">
                    <div class="check-icon passed">✓</div>
                    <div>
                        <strong>Network Isolation</strong>
                        <div class="metric-description">Limited external network access</div>
                    </div>
                </div>
                <div class="checklist-item">
                    <div class="check-icon passed">✓</div>
                    <div>
                        <strong>Local Storage Only</strong>
                        <div class="metric-description">No data sent to external services</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Monitor -->
        <div class="network-monitor">
            <h2 class="section-title">📡 Network Activity Monitor</h2>
            <div class="connections-list" id="connections-list">
                <div class="connection-item">
                    <div>
                        <strong>127.0.0.1:11434</strong>
                        <div class="metric-description">Ollama Local Server</div>
                    </div>
                    <span class="status success">Local</span>
                </div>
                <div class="connection-item">
                    <div>
                        <strong>127.0.0.1:3000</strong>
                        <div class="metric-description">Web UI Interface</div>
                    </div>
                    <span class="status success">Local</span>
                </div>
            </div>
        </div>

        <!-- Privacy Controls -->
        <div class="privacy-controls">
            <button class="control-button primary" onclick="generatePrivacyReport()">
                📊 Generate Privacy Report
            </button>
            <button class="control-button secondary" onclick="exportSecurityLogs()">
                📋 Export Security Logs
            </button>
            <button class="control-button warning" onclick="toggleOfflineMode()">
                📴 Toggle Offline Mode
            </button>
            <button class="control-button danger" onclick="emergencyPurge()">
                🚨 Emergency Purge
            </button>
        </div>

        <!-- System Logs -->
        <div class="logs-viewer">
            <h2 class="section-title">📝 Security & Privacy Logs</h2>
            <div class="logs-content" id="logs-content">
                Loading security logs...
            </div>
        </div>

        <!-- Privacy Score Visualization -->
        <div class="metric-card" style="text-align: center;">
            <h2 class="section-title">🎯 Privacy Score Breakdown</h2>
            <div class="progress-ring">
                <svg width="120" height="120">
                    <circle class="background" cx="60" cy="60" r="54"></circle>
                    <circle class="progress" cx="60" cy="60" r="54" style="stroke-dasharray: 90 100;"></circle>
                </svg>
            </div>
            <div class="metric-value">95/100</div>
            <div class="metric-description">Excellent privacy protection</div>
        </div>
    </div>

    <script>
        let sessionStartTime = Date.now();
        let logsUpdateInterval;
        let statusUpdateInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
            startRealTimeMonitoring();
        });

        function initializeDashboard() {
            updateSessionTimer();
            loadPrivacyMetrics();
            loadSecurityChecks();
            loadNetworkConnections();
            loadSecurityLogs();
        }

        function startRealTimeMonitoring() {
            // Update session timer every second
            setInterval(updateSessionTimer, 1000);

            // Update status every 5 seconds
            statusUpdateInterval = setInterval(updateSystemStatus, 5000);

            // Update logs every 10 seconds
            logsUpdateInterval = setInterval(loadSecurityLogs, 10000);
        }

        function updateSessionTimer() {
            const elapsed = Date.now() - sessionStartTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);

            document.getElementById('session-time').textContent =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function loadPrivacyMetrics() {
            try {
                const response = await fetch('/api/privacy/metrics', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const metrics = await response.json();
                    updatePrivacyMetrics(metrics);
                }
            } catch (error) {
                console.error('Failed to load privacy metrics:', error);
            }
        }

        function updatePrivacyMetrics(metrics) {
            document.getElementById('privacy-score').textContent = `${metrics.privacy_score}%`;
            document.getElementById('network-status').textContent = metrics.offline_mode ? 'Offline' : 'Monitored';
            document.getElementById('encryption-status').textContent = metrics.encryption_enabled ? 'Active' : 'Disabled';

            // Update privacy score visualization
            const progressCircle = document.querySelector('.progress-ring .progress');
            const score = metrics.privacy_score;
            const circumference = 2 * Math.PI * 54;
            const strokeDasharray = `${(score / 100) * circumference} ${circumference}`;
            progressCircle.style.strokeDasharray = strokeDasharray;

            // Update color based on score
            if (score >= 90) {
                progressCircle.style.stroke = '#10b981';
            } else if (score >= 70) {
                progressCircle.style.stroke = '#f59e0b';
            } else {
                progressCircle.style.stroke = '#ef4444';
            }
        }

        async function loadSecurityChecks() {
            try {
                const response = await fetch('/api/privacy/checks', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const checks = await response.json();
                    updateSecurityChecks(checks);
                }
            } catch (error) {
                console.error('Failed to load security checks:', error);
            }
        }

        function updateSecurityChecks(checks) {
            const checksContainer = document.getElementById('security-checks');

            checksContainer.innerHTML = checks.map(check => `
                <div class="checklist-item">
                    <div class="check-icon ${check.status}">
                        ${check.status === 'passed' ? '✓' : check.status === 'failed' ? '✗' : '!'}
                    </div>
                    <div>
                        <strong>${check.name}</strong>
                        <div class="metric-description">${check.description}</div>
                    </div>
                </div>
            `).join('');
        }

        async function loadNetworkConnections() {
            try {
                const response = await fetch('/api/privacy/connections', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const connections = await response.json();
                    updateNetworkConnections(connections);
                }
            } catch (error) {
                console.error('Failed to load network connections:', error);
            }
        }

        function updateNetworkConnections(connections) {
            const connectionsContainer = document.getElementById('connections-list');

            if (connections.length === 0) {
                connectionsContainer.innerHTML = '<div class="connection-item"><div>No active connections detected</div></div>';
                return;
            }

            connectionsContainer.innerHTML = connections.map(conn => `
                <div class="connection-item ${conn.is_external ? 'external' : ''}">
                    <div>
                        <strong>${conn.local_address} → ${conn.remote_address}</strong>
                        <div class="metric-description">${conn.process_name || 'Unknown Process'}</div>
                    </div>
                    <span class="status ${conn.is_external ? 'error' : 'success'}">
                        ${conn.is_external ? 'External' : 'Local'}
                    </span>
                </div>
            `).join('');
        }

        async function loadSecurityLogs() {
            try {
                const response = await fetch('/api/privacy/logs', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const logs = await response.json();
                    updateSecurityLogs(logs);
                }
            } catch (error) {
                console.error('Failed to load security logs:', error);
            }
        }

        function updateSecurityLogs(logs) {
            const logsContainer = document.getElementById('logs-content');

            if (logs.length === 0) {
                logsContainer.textContent = 'No security events logged.';
                return;
            }

            const logText = logs.map(log =>
                `[${new Date(log.timestamp).toLocaleString()}] ${log.level.toUpperCase()}: ${log.message}`
            ).join('\n');

            logsContainer.textContent = logText;
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        async function updateSystemStatus() {
            try {
                const response = await fetch('/api/health', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const status = await response.json();
                    // Update status indicators based on health check
                }
            } catch (error) {
                console.error('Failed to update system status:', error);
            }
        }

        async function generatePrivacyReport() {
            try {
                const response = await fetch('/api/privacy/report', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const report = await response.blob();
                    downloadFile(report, 'privacy-report.json');
                    showAlert('Privacy report generated successfully!', 'success');
                } else {
                    showAlert('Failed to generate privacy report', 'error');
                }
            } catch (error) {
                showAlert(`Network error: ${error.message}`, 'error');
            }
        }

        async function exportSecurityLogs() {
            try {
                const response = await fetch('/api/privacy/logs/export', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const logs = await response.blob();
                    downloadFile(logs, 'security-logs.txt');
                    showAlert('Security logs exported successfully!', 'success');
                } else {
                    showAlert('Failed to export security logs', 'error');
                }
            } catch (error) {
                showAlert(`Network error: ${error.message}`, 'error');
            }
        }

        async function toggleOfflineMode() {
            try {
                const response = await fetch('/api/privacy/offline-mode', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    showAlert(`Offline mode ${result.enabled ? 'enabled' : 'disabled'}`, 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showAlert('Failed to toggle offline mode', 'error');
                }
            } catch (error) {
                showAlert(`Network error: ${error.message}`, 'error');
            }
        }

        async function emergencyPurge() {
            const confirmation = prompt('Type "PURGE_ALL_DATA" to confirm emergency data purge:');

            if (confirmation !== 'PURGE_ALL_DATA') {
                showAlert('Emergency purge cancelled', 'warning');
                return;
            }

            try {
                const response = await fetch('/api/privacy/purge', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('api_key')}`
                    }
                });

                if (response.ok) {
                    showAlert('Emergency purge initiated! System will restart.', 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 3000);
                } else {
                    showAlert('Emergency purge failed', 'error');
                }
            } catch (error) {
                showAlert(`Network error: ${error.message}`, 'error');
            }
        }

        function downloadFile(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            document.body.insertBefore(alertDiv, document.body.firstChild);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (statusUpdateInterval) clearInterval(statusUpdateInterval);
            if (logsUpdateInterval) clearInterval(logsUpdateInterval);
        });
    </script>
</body>
</html>